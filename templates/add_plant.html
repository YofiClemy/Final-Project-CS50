{% extends "layout.html" %}
{% block title %}Add Plant · PlantWeb{% endblock %}
{% block content %}
<div class="container" style="max-width:720px">
  <h1 class="mb-4">Add a plant</h1>

  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <form method="post" enctype="multipart/form-data" class="vstack gap-3">
    <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">

    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Name</label>
        <input class="form-control" name="name" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Room</label>
        <input class="form-control" name="room" placeholder="Kitchen, Living room…">
      </div>
    </div>

    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Added on</label>
        <input class="form-control" type="date" name="added" value="{{ date.today().isoformat() }}">
      </div>
      <div class="col-md-6">
        <label class="form-label">Watering interval (days)</label>
        <input class="form-control" type="number" name="winterval" min="1" max="365" value="7">
      </div>
    </div>

    <div>
      <label class="form-label d-block">Image source</label>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="photo_mode" id="pmUpload" value="upload" checked>
        <label class="form-check-label" for="pmUpload">Upload</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="photo_mode" id="pmStock" value="stock">
        <label class="form-check-label" for="pmStock">Choose from library</label>
      </div>
    </div>

    <div id="uploadWrap">
      <label class="form-label">Upload a photo (2 MB max)</label>
      <input class="form-control" type="file" name="photo" accept="image/*">
    </div>

    <div id="stockWrap" class="d-none">
      <label class="form-label">Choose a stock image</label>
      <select class="form-select" name="stock_key">
        <option value="" selected disabled>Pick one…</option>
        {% for key, path in stock_images.items() %}
          <option value="{{ key }}">{{ key|replace('_',' ')|title }}</option>
        {% endfor %}
      </select>
      <p class="form-text">Images are served from <code>static/stock/</code>.</p>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-primary" type="submit">Save plant</button>
      <a class="btn btn-outline-secondary" href="{{ url_for('my_plants') }}">Cancel</a>
    </div>
  </form>
</div>

<script>
  const pmUpload = document.getElementById('pmUpload');
  const pmStock  = document.getElementById('pmStock');
  const uploadWrap = document.getElementById('uploadWrap');
  const stockWrap  = document.getElementById('stockWrap');

  function syncMode(){
    const stock = pmStock.checked;
    stockWrap.classList.toggle('d-none', !stock);
    uploadWrap.classList.toggle('d-none', stock);
  }
  pmUpload.addEventListener('change', syncMode);
  pmStock.addEventListener('change', syncMode);
  syncMode();
</script>
{% endblock %}